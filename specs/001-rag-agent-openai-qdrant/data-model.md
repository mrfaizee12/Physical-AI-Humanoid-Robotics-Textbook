# Data Model: RAG-enabled Agent using OpenAI Agents SDK + Qdrant Retrieval

## Entities

### TextQuery
- **Description**: User input in natural language form that requires an answer based on retrieved knowledge
- **Fields**:
  - query_text (string): The original text query from the user
  - query_embedding (list[float]): Numerical representation of the text query for similarity search
  - timestamp (datetime): When the query was received
- **Validation**: Must not be empty or malformed

### RetrievedChunk
- **Description**: Document segments retrieved from the Qdrant rag_embedding collection that are relevant to the query
- **Fields**:
  - content (string): The text content of the retrieved chunk
  - score (float): Similarity score from the vector search
  - metadata (dict): Additional metadata from Qdrant (source, page number, etc.)
  - id (string): Unique identifier for the chunk in Qdrant
- **Relationships**: Linked to TextQuery through retrieval process

### GroundedResponse
- **Description**: Answer generated by the agent that contains only information present in the retrieved document chunks
- **Fields**:
  - response_text (string): The final response text
  - source_chunks (list[RetrievedChunk]): References to the chunks used to generate the response
  - confidence_score (float): Confidence level in the response based on source chunk relevance
  - timestamp (datetime): When the response was generated
- **Relationships**: Generated from TextQuery and RetrievedChunks

### QdrantConnection
- **Description**: Configuration for connecting to the Qdrant vector database
- **Fields**:
  - url (string): Qdrant instance URL
  - api_key (string): Authentication key for Qdrant
  - collection_name (string): Name of the collection to search (rag_embedding)
  - vector_size (int): Dimension of the embedding vectors
- **Validation**: URL must be valid, API key must authenticate successfully

## State Transitions

### Query Processing Flow
1. **TextQuery received** → Query validation
2. **Validation passed** → Query embedding
3. **Embedding completed** → Qdrant search
4. **Search completed** → RetrievedChunk selection
5. **Chunks selected** → Response generation
6. **Response generated** → GroundedResponse returned

## Validation Rules

- TextQuery must be non-empty and contain meaningful content
- RetrievedChunk score must meet minimum threshold for relevance
- GroundedResponse must only contain information present in RetrievedChunks
- QdrantConnection parameters must be valid and allow successful connection