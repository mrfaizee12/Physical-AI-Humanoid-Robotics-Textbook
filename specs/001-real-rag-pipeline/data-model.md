# Data Model: Real RAG Pipeline

## Entities

### Query
**Description**: User input question that requires textbook-based response
**Fields**:
- `text` (string): The user's question text
- `max_chunks` (integer, optional): Maximum number of text chunks to retrieve (default: 5)
- `similarity_threshold` (float, optional): Minimum similarity score for retrieved chunks (default: 0.5)

### Embedding
**Description**: Vector representation of user query for similarity search
**Fields**:
- `vector` (array of floats): The embedding vector representation
- `model` (string): The model used to generate the embedding
- `dimension` (integer): The dimensionality of the embedding vector

### TextChunk
**Description**: Relevant segment of textbook content retrieved from Qdrant
**Fields**:
- `id` (string): Unique identifier for the chunk
- `content` (string): The actual text content of the chunk
- `metadata` (object): Additional information about the chunk
  - `source` (string): Source document or section
  - `page_number` (integer, optional): Page number in the source
  - `section_title` (string, optional): Title of the section
  - `url` (string, optional): URL reference to the source
  - `citation` (string): IEEE-formatted citation
- `similarity_score` (float): Similarity score relative to the query

### RAGResponse
**Description**: Structured response containing textbook-based content and citations
**Fields**:
- `answer` (string): The answer generated by the LLM based on retrieved context
- `citations` (array of objects): List of citations for the sources used
  - `text` (string): The citation text in IEEE format
  - `source` (string): Source identifier
  - `url` (string, optional): URL to the source
- `chunks_used` (array of TextChunk): The chunks that were used to generate the answer
- `query` (string): The original user query (echoed back)
- `timestamp` (string): ISO 8601 timestamp of the response

### ErrorResponse
**Description**: Standardized error response format
**Fields**:
- `error` (string): Error message
- `code` (string): Error code
- `details` (object, optional): Additional error details

## Relationships
- A `Query` generates an `Embedding` for searching
- An `Embedding` is used to retrieve multiple `TextChunk` objects from Qdrant
- Multiple `TextChunk` objects are used to generate a single `RAGResponse`
- If no relevant chunks are found, a fallback response is returned instead of a `RAGResponse`

## Validation Rules
- `Query.text` must not be empty or exceed 1000 characters
- `similarity_threshold` must be between 0.0 and 1.0
- `max_chunks` must be between 1 and 10
- `TextChunk.similarity_score` must be between 0.0 and 1.0
- `RAGResponse.answer` must not be empty when response is successful